var WPGlobusCore;!function(a){var b;b=WPGlobusCore={strpos:function(a,b,c){var d=a.indexOf(b,c);return d>=0?d:!1},TextFilter:function(a,c,d){if("undefined"==typeof a||""===a)return a;var e,f,g=[],h=!1;c=""==c?"en":c,d="undefined"==typeof d||""==d?"RETURN_IN_DEFAULT_LANGUAGE":d,g[0]=[],g[0].start=WPGlobusCoreData.locale_tag_start.replace("%s",c),g[0].end=WPGlobusCoreData.locale_tag_end,g[1]=[],g[1].start="<!--:"+c+"-->",g[1].end="<!--:-->",g[2]=[],g[2].start="[:"+c+"]",g[2].end="[:";for(var i=0;3>i;i++)if(e=b.strpos(a,g[i].start),e!==!1){e+=g[i].start.length,f=b.strpos(a,g[i].end,e),a=f===!1?a.substr(e):a.substr(e,f-e),h=!0;break}return h||("RETURN_EMPTY"==d?(c!=WPGlobusCoreData.default_language||/(\{:|\[:|<!--:)[a-z]{2}/.test(a))&&(a=""):c==WPGlobusCoreData.default_language?/(\{:|\[:|<!--:)[a-z]{2}/.test(a)&&(a=""):a=b.TextFilter(a,WPGlobusCoreData.default_language)),a},addLocaleMarks:function(a,b){return WPGlobusCoreData.locale_tag_start.replace("%s",b)+a+WPGlobusCoreData.locale_tag_end},getTranslations:function(c){var d,e={};return a.each(WPGlobusCoreData.enabled_languages,function(a,f){d=f==WPGlobusCoreData.default_language?"RETURN_IN_DEFAULT_LANGUAGE":"RETURN_EMPTY",e[f]=b.TextFilter(c,f,d)}),e}}}(jQuery);var WPGlobusDialogApp;!function(a){var b;b=WPGlobusDialogApp={option:{listenClass:".wpglobus_dialog_start",dialogTabs:"#wpglobus-dialog-tabs",title:""},form:void 0,element:void 0,id:"",wpglobus_id:"",type:"textarea",source:"",order:{},value:{},request:"core",init:function(c){b.option=a.extend(b.option,c),a(b.option.dialogTabs).tabs(),this.attachListener()},saveDialog:function(){var c,d,e,f="",g="",h="";a(".wpglobus_dialog_textarea").each(function(b,i){c=a(i),d=c.val(),e=c.data("language"),e==WPGlobusAdmin.data.language&&(h=d),""!=d&&(f+=WPGlobusCore.addLocaleMarks(d,e),e==WPGlobusCoreData.default_language&&(g=d))}),f=f.length==g.length+8?g:f,a(b.id).val(f),f=""==h?g:h,a(b.wpglobus_id).val(f)},dialog:a("#wpglobus-dialog-wrapper").dialog({autoOpen:!1,height:250,width:650,modal:!0,dialogClass:"wpglobus-dialog",buttons:[{text:"Save",click:function(){b.saveDialog(),b.dialog.dialog("close")}},{text:"Cancel",click:function(){b.dialog.dialog("close")}}],open:function(){a(".wpglobus-dialog .ui-dialog-title").text(b.option.title)},close:function(){b.form[0].reset()}}),attachListener:function(){a(document).on("click",b.option.listenClass,function(){b.element=a(this),b.id=b.element.data("source-id"),b.wpglobus_id="#wpglobus-"+b.id,b.id="#"+b.id,b.source=b.element.data("source-value"),"undefined"==typeof b.source&&(b.source=a(b.id).val(),"ajax"==b.request?(b.order.action="get_translate",b.order.source=b.source,b.ajax(b.order)):b.value=WPGlobusCore.getTranslations(b.source)),a.each(b.value,function(b,c){a("#wpglobus-dialog-"+b).val(c)}),b.dialog.dialog("open")}),a(document).on("click",".wpglobus-control-head",function(){a(".wpglobus-dialog-field-source").toggleClass("hidden")}),b.form=b.dialog.find("form#wpglobus-dialog-form").on("submit",function(a){a.preventDefault(),b.saveDialog()})},ajax:function(c){a.ajax({type:"POST",url:WPGlobusAdmin.ajaxurl,data:{action:WPGlobusAdmin.process_ajax,order:c},dataType:"json",async:!1}).done(function(a){b.value=a}).fail(function(){}).always(function(){})}}}(jQuery),jQuery(document).ready(function(){"use strict";window.WPGlobusAdminApp=function(a,b){return a.App=function(a){void 0===window.WPGlobusAdminApp&&(this.config={debug:!1,version:WPGlobusAdmin.version},this.status="ok","undefined"===WPGlobusAdmin?(this.status="error",this.config.debug&&console.log("Error options loading")):this.config.debug&&console.dir(WPGlobusAdmin),this.config.disable_first_language=['<div id="disable_first_language" style="display:block;" class="redux-field-errors notice-red">',"<strong>","<span>&nbsp;</span>",WPGlobusAdmin.i18n.cannot_disable_language,"</strong>","</div>"].join(""),b.extend(this.config,a),"ok"===this.status&&this.init())},a.App.prototype={init:function(){b("#content").addClass("wpglobus-editor").attr("data-language",WPGlobusAdmin.data.default_language),b("textarea[id^=content_]").each(function(a,c){var d=b(c).attr("id").replace("content_","");b(c).attr("data-language",d)}),"post-edit"===WPGlobusAdmin.page?(this.post_edit(),this.set_dialog()):"menu-edit"===WPGlobusAdmin.page?this.nav_menus():"taxonomy-edit"===WPGlobusAdmin.page?WPGlobusAdmin.data.tag_id&&this.taxonomy_edit():"taxonomy-quick-edit"===WPGlobusAdmin.page?this.quick_edit("taxonomy"):"edit.php"===WPGlobusAdmin.page?this.quick_edit("post"):"options-general.php"==WPGlobusAdmin.page?this.options_general():"widgets.php"==WPGlobusAdmin.page?(WPGlobusWidgets.init(),WPGlobusDialogApp.init({title:"Edit text"})):this.start()},options_general:function(){var a=b("#blogname"),c=b("body");a.addClass("hidden"),b("#wpglobus-blogname").insertAfter(a),c.on("blur",".wpglobus-blogname",function(){var c="";b(".wpglobus-blogname").each(function(a,d){var e=b(d),f=e.data("language");""!==e.val()&&(c=c+WPGlobusAdmin.data.locale_tag_start.replace("%s",f)+e.val()+WPGlobusAdmin.data.locale_tag_end)}),a.val(c)});var d=b("#blogdescription");d.addClass("hidden"),b("#wpglobus-blogdescription").insertAfter(d),c.on("blur",".wpglobus-blogdesc",function(){var a="";b(".wpglobus-blogdesc").each(function(c,d){var e=b(d),f=e.data("language");""!==e.val()&&(a=a+WPGlobusAdmin.data.locale_tag_start.replace("%s",f)+e.val()+WPGlobusAdmin.data.locale_tag_end)}),d.val(a)})},quick_edit:function(a){if("undefined"!=typeof WPGlobusAdmin.data.has_items&&WPGlobusAdmin.data.has_items){var c="",d=0;b(document).ajaxComplete(function(a,e,f){"undefined"!=typeof f.data&&""!=c&&f.data.indexOf("action=inline-save-tax&")>=0&&(b("#"+c+" a.row-title").text(WPGlobusAdmin.qedit_titles[d][WPGlobusAdmin.data.language].name),b("#"+c+" .description").text(WPGlobusAdmin.qedit_titles[d][WPGlobusAdmin.data.language].description))});var e={};b("#the-list tr").each(function(c,f){var g=b(f),h="post"===a?"post-":"tag-";d=g.attr("id").replace(h,""),e[d]={},"post"===a?e[d].source=g.find(".post_title").text():"taxonomy"===a&&(e[d].source=b("#inline_"+d+" .name").text())});var f={};f.action="get_titles",f.type=a,f.taxonomy="undefined"==typeof WPGlobusAdmin.data.taxonomy?!1:WPGlobusAdmin.data.taxonomy,f.title=e,b.ajax({type:"POST",url:WPGlobusAdmin.ajaxurl,data:{action:WPGlobusAdmin.process_ajax,order:f},dataType:"json"}).done(function(a){WPGlobusAdmin.qedit_titles=a.qedit_titles,b.each(a.bulkedit_post_titles,function(a,c){b("#inline_"+a+" .post_title").text(c[WPGlobusAdmin.data.language].name)})}).fail(function(){}).always(function(){}),b("body").on("change",".wpglobus-quick-edit-title",function(){var a="",c=[];b(".wpglobus-quick-edit-title").each(function(e,f){var g=b(f),h=g.data("language");""!==g.val()&&(a=a+WPGlobusAdmin.data.locale_tag_start.replace("%s",h)+g.val()+WPGlobusAdmin.data.locale_tag_end),WPGlobusAdmin.qedit_titles[d][h].name=g.val(),c[e]=h});var e=b(document).triggerHandler("wpglobus_get_translations",{string:a,lang:c,id:d});"undefined"!=typeof e&&(a=e),b("input.ptitle").eq(0).val(a),WPGlobusAdmin.qedit_titles[d].source=a}),"undefined"!=typeof WPGlobusAdmin.data.tags&&b.each(WPGlobusAdmin.data.tags,function(a,b){WPGlobusAdmin.data.value[b].post_id={}}),b("a.save, input#bulk_edit").on("mouseenter",function(a){"undefined"!=typeof WPGlobusAdmin.data.tags&&("bulk_edit"==a.currentTarget.id?b("input#bulk_edit").unbind("click"):b("a.save").unbind("click"),b("a.save, input#bulk_edit").click(function(a){"bulk_edit"!=a.currentTarget.id&&b.ajaxSetup({async:!1});var c,d,e,f=b(this).parents("tr"),g=f.attr("id").replace("edit-","");b.each(WPGlobusAdmin.data.tags,function(a,b){if(c=f.find("textarea[name='"+WPGlobusAdmin.data.names[b]+"']"),0==c.size())return!0;WPGlobusAdmin.data.value[b].post_id[g]=c.val(),d=WPGlobusAdmin.data.value[b].post_id[g].split(","),e=[];for(var h=0;h<d.length;h++)d[h]=d[h].trim(" "),""!=d[h]&&(e[h]="undefined"==typeof WPGlobusAdmin.data.tag[b][d[h]]?d[h]:WPGlobusAdmin.data.tag[b][d[h]]);c.val(e.join(", "))}),"bulk_edit"!=a.currentTarget.id&&(inlineEditPost.save(g),b.ajaxSetup({async:!0}))}))}),b("#the-list").on("click","a.editinline",function(){var e=b(this);if(c=e.parents("tr").attr("id"),"post"===a)d=c.replace("post-","");else{if("taxonomy"!==a)return;d=c.replace("tag-","")}"post"===a&&"undefined"!=typeof WPGlobusAdmin.data.tags&&b.each(WPGlobusAdmin.data.tags,function(a,c){""!=WPGlobusAdmin.data.value[c]&&"undefined"!=typeof WPGlobusAdmin.data.value[c].post_id[d]&&b("#edit-"+d+' textarea[name="'+WPGlobusAdmin.data.names[c]+'"]').val(WPGlobusAdmin.data.value[c].post_id[d])});var f=b("#edit-"+d+" input.ptitle").eq(0),g=f.parents("label");f.val(WPGlobusAdmin.qedit_titles[d].source),f.addClass("hidden"),b(WPGlobusAdmin.data.template).insertAfter(g),"undefined"==typeof WPGlobusAdmin.qedit_titles[d]&&(WPGlobusAdmin.qedit_titles[d]={},WPGlobusAdmin.qedit_titles[d].source=b("#"+c+" .name a.row-title").text(),b(WPGlobusAdmin.data.enabled_languages).each(function(a,b){WPGlobusAdmin.qedit_titles[d][b]={},WPGlobusAdmin.qedit_titles[d][b].name=b==WPGlobusAdmin.data.default_language?WPGlobusAdmin.qedit_titles[d].source:"",WPGlobusAdmin.qedit_titles[d][b].description=""})),b(".wpglobus-quick-edit-title").each(function(a,c){var e=b(c).data("language");b(c).attr("id",e+d),"undefined"!=typeof WPGlobusAdmin.qedit_titles[d][e]&&b(c).attr("value",WPGlobusAdmin.qedit_titles[d][e].name.replace(/\\\'/g,"'"))})})}},taxonomy_edit:function(){var a=b(".form-table").eq(0);b.each(WPGlobusAdmin.tabs,function(c,d){var e=b(a[0].outerHTML),f="default"===d?WPGlobusAdmin.data.default_language:d;e.attr("id","table-"+d);var g=b(e);g.find("#name").attr("value",WPGlobusAdmin.data.i18n[d].name).attr("id","name-"+d).attr("name","name-"+d).addClass("wpglobus-taxonomy").attr("data-save-to","name").attr("data-language",f),g.find("#slug").attr("id","slug-"+d).attr("name","slug-"+d).addClass("wpglobus-taxonomy").attr("data-save-to","slug").attr("data-language",f),g.find("#parent").attr("id","parent-"+d).attr("name","parent-"+d).addClass("wpglobus-taxonomy").attr("data-save-to","parent").attr("data-language",f),g.find("#description").text(WPGlobusAdmin.data.i18n[d].description).attr("id","description-"+d).attr("name","description-"+d).addClass("wpglobus-taxonomy").attr("data-save-to","description").attr("data-language",f),"default"!==d&&(g.find("#slug-"+d).addClass("wpglobus-nosave").parents("tr").css("display","none"),g.find("#parent-"+d).addClass("wpglobus-nosave").parents("tr").css("display","none")),b("#tab-"+d).append(g[0].outerHTML)}),b(".wpglobus-taxonomy-tabs-ul").insertAfter("#ajax-response"),a.css("display","none"),b(".wrap").tabs(),b(".wpglobus-taxonomy").on("blur",function(){var a=b(this),c=a.data("save-to"),d="";"parent"===c||"slug"===c?d=a.val():b(".wpglobus-taxonomy").each(function(a,e){var f=b(e);f.hasClass("wpglobus-nosave")||c===f.data("save-to")&&""!==f.val()&&(d=d+WPGlobusAdmin.data.locale_tag_start.replace("%s",f.data("language"))+f.val()+WPGlobusAdmin.data.locale_tag_end)}),b("#"+c).val(d)})},nav_menus:function(){var a,c,d="#menu-to-edit .menu-item",e=function(){c!==b(d).size()&&(clearInterval(a),b(d).each(function(a,c){var d=b(c);if(!d.hasClass("wpglobus-menu-item")){var e=b(c).attr("id");b.each(["input.edit-menu-item-title","input.edit-menu-item-attr-title"],function(a,c){var d=b("#"+e+" "+c),f=b(d);if(!f.hasClass("wpglobus-hidden")){f.addClass("wpglobus-hidden"),f.css("display","none");var g=f.parent("label"),h=f.parents("p");b(h).css("height","80px"),b(g).append('<div style="color:#f00;">'+WPGlobusAdmin.i18n.save_nav_menu+"</div>")}}),d.addClass("wpglobus-menu-item")}}))};b.ajaxSetup({beforeSend:function(f,g){"undefined"!=typeof g.data&&g.data.indexOf("action=add-menu-item")>=0&&(c=b(d).size(),a=setInterval(e,500))}}),b(d).each(function(a,c){var d=b(c).attr("id"),e=d.replace("menu-item-","");b.each(["input.edit-menu-item-title","input.edit-menu-item-attr-title"],function(a,c){var f=b("#"+d+" "+c),g=b("#"+d+" "+c).parents("p"),h=0;b.each(WPGlobusAdmin.data.open_languages,function(d,i){var j=b(f[0].outerHTML);j.attr("id",b(f).attr("id")+"-"+i),j.attr("name",b(f).attr("id")+"-"+i),j.attr("data-language",i),j.attr("data-item-id",e),j.attr("placeholder",WPGlobusAdmin.data.en_language_name[i]);var k=WPGlobusAdmin.data.items[e][i][c]["class"];0===a&&i===WPGlobusAdmin.data.default_language?j.attr("class",k+" edit-menu-item-title"):j.attr("class",k),j.attr("value",WPGlobusAdmin.data.items[e][i][c].caption),j.css("margin-bottom","0.6em"),b(g).append(j[0].outerHTML),h=d}),h=40*(h+1),b(f).css("display","none").attr("class","").addClass("widefat wpglobus-hidden"),b(g).css("height",h+"px").addClass("wpglobus-menu-item-box")}),b(c).addClass("wpglobus-menu-item")}),b(".menus-move-left, .menus-move-right").each(function(a,c){var d,e=b(c),f=(e.parents("li").attr("id").replace("menu-item-",""),e.attr("title"));"undefined"!=typeof f&&b.each(WPGlobusAdmin.data.post_titles,function(a,b){f.indexOf(a)>=0&&(d=f.replace(a,b),e.attr("title",d),e.text(d))})}),b(".edit-menu-item-title").trigger("change"),wpNavMenu.refreshAdvancedAccessibility(),wpNavMenu.menusChanged=!1,b(".wpglobus-menu-item").on("change",function(){var a,c,d,e,f=b(this),g="",h="",i=[];f.hasClass("wpglobus-item-title")&&(a=f.parents("li"),c=a.attr("id"),b.each(b("#"+c+" .wpglobus-item-title"),function(a,c){e=b(c);var d=e.data("language");""!==e.val()&&(g=g+WPGlobusAdmin.data.locale_tag_start.replace("%s",d)+e.val()+WPGlobusAdmin.data.locale_tag_end),i[a]=d,h=e.data("item-id")}),d=b(document).triggerHandler("wpglobus_get_menu_translations",{string:g,lang:i,id:h,type:"input.edit-menu-item-title"}),"undefined"!=typeof d&&(g=d),b("input#edit-menu-item-title-"+h).val(g)),f.hasClass("wpglobus-item-attr")&&(a=f.parents("li"),c=a.attr("id"),b.each(b("#"+c+" .wpglobus-item-attr"),function(a,c){e=b(c);var d=e.data("language");""!==e.val()&&(g=g+WPGlobusAdmin.data.locale_tag_start.replace("%s",d)+e.val()+WPGlobusAdmin.data.locale_tag_end),i[a]=d,h=e.data("item-id")}),d=b(document).triggerHandler("wpglobus_get_menu_translations",{string:g,lang:i,id:h,type:"input.edit-menu-item-attr-title"}),"undefined"!=typeof d&&(g=d),b("input#edit-menu-item-attr-title-"+h).val(g))})},post_edit:function(){b(document).on("heartbeat-send",function(a,c){"undefined"!=typeof c.wp_autosave&&(c.wpglobus_heartbeat="wpglobus",b.each(WPGlobusAdmin.data.open_languages,function(a,d){var e=b("#title_"+d).val()||"";e=b.trim(e),""!=e&&(c.wp_autosave["post_title_"+d]=e),e=b("#content_"+d).val()||"",e=b.trim(e),""!=e&&(c.wp_autosave["content_"+d]=e)}))}),b("#post-body-content").prepend(b(".wpglobus-post-tabs-ul")),b.each(WPGlobusAdmin.tabs,function(a,c){"default"===c?(b("#postdivrich").wrap('<div id="tab-default"></div>'),b(b("#titlediv")).insertBefore("#postdivrich")):(b("#postdivrich-"+c).wrap('<div id="tab-'+c+'"></div>'),b(b("#titlediv-"+c)).insertBefore("#postdivrich-"+c))}),b("#post-body-content").tabs(),b("#title").val(WPGlobusAdmin.title),b("#content").text(WPGlobusAdmin.content),b("#excerpt").addClass("hidden"),"undefined"!=typeof WPGlobusVendor&&wpglobus_wpseo(),WPGlobusAdmin.data.modify_excerpt&&(b(WPGlobusAdmin.data.template).insertAfter("#excerpt"),b("body").on("blur",".wpglobus-excerpt",function(){var a="";b(".wpglobus-excerpt").each(function(c,d){var e=b(d);""!==e.val()&&(a=a+WPGlobusAdmin.data.locale_tag_start.replace("%s",e.data("language"))+e.val()+WPGlobusAdmin.data.locale_tag_end)}),b("#excerpt").eq(0).val(a)})),b("body").on("click","#publish, #save-post",function(){if(WPGlobusAdmin.data.open_languages.length>1){var a,c=b("#title").val(),d="",e="";0==c.length&&(a=WPGlobusAdmin.data.open_languages.indexOf(WPGlobusAdmin.data.default_language),WPGlobusAdmin.data.open_languages.splice(a,1),b(WPGlobusAdmin.data.open_languages).each(function(a,f){e=0==a?"":"-",c=b("#title_"+f).val(),c.length>0&&(0==d.length&&(e=""),d=d+e+c)})),d.length>0&&b("#title").val(d)}"undefined"==typeof WPGlobusAdmin.data.tagsdiv||WPGlobusAdmin.data.tagsdiv.length<1||b(WPGlobusAdmin.data.tagsdiv).each(function(a,c){if(0==b("#"+c).size())return!0;var d=c.replace("tagsdiv-","");if("undefined"===d)return!0;if(0==b("#tax-input-"+d).size())return!0;var e,f=[];b("#tagsdiv-"+d+" .tagchecklist span").each(function(a,c){e=b(c).text(),e=e.replace("X","").trim(" "),f[a]="undefined"==typeof WPGlobusAdmin.data.tag[d][e]?e:WPGlobusAdmin.data.tag[d][e]}),b("#tax-input-"+d).val(f.join(", "))})}),b(".ui-state-default").on("click",function(){"link-tab-default"===b(this).attr("id")&&(b(window).scrollTop(b(window).scrollTop()+1),b(window).scrollTop(b(window).scrollTop()-1))})},start:function(){var a=this;b("#wpglobus_flags").select2({formatResult:this.format,formatSelection:this.format,minimumResultsForSearch:-1,escapeMarkup:function(a){return a}}),b("body").on("click","#enabled_languages-list li:first input",function(c){return c.preventDefault(),b(".redux-save-warn").css({display:"none"}),b("#enabled_languages-list").find("li:first > input").val("1"),0===b("#disable_first_language").length&&b(a.config.disable_first_language).insertAfter("#info_bar"),!1})},format:function(a){return'<img class="wpglobus_flag" src="'+WPGlobusAdmin.flag_url+a.text+'"/>&nbsp;&nbsp;'+a.text},set_dialog:function(){var a,c=function(a){var c,d;"undefined"==typeof a?(b("#list-table thead tr").append('<th class="wpglobus-control-head"></th>'),d="#the-list tr"):d="#the-list tr#"+a,b(d).each(function(){var a,d,e=b(this),f=e.find("textarea");c=f.attr("id"),a=b("#"+c).clone(),b(f).addClass("wpglobus-dialog-field-source hidden"),d=f.attr("name"),b(a).attr("id","wpglobus-"+c),b(a).attr("name","wpglobus-"+d),b(a).attr("data-source-id",c),b(a).attr("class","wpglobus-dialog-field"),b(a).val(WPGlobusCore.TextFilter(b(f).val(),WPGlobusCoreData.language)),b(a).insertAfter(f),e.append('<td style="width:20px;"><div data-type="control" data-source-type="textarea" data-source-id="'+c+'" class="wpglobus_dialog_start wpglobus_dialog_icon"></div></td>')})};c(),b("body").on("change",".wpglobus-dialog-field",function(){var a,c=b(this),d="#"+c.data("source-id"),e="",f="";"undefined"!=typeof d&&(e=b(d).val(),/(\{:|\[:|<!--:)[a-z]{2}/.test(e)?(b.each(WPGlobusCoreData.enabled_languages,function(b,d){a=d==WPGlobusCoreData.language?c.val():WPGlobusCore.TextFilter(e,d,"RETURN_EMPTY"),""!=a&&(f+=WPGlobusCore.addLocaleMarks(a,d))}),b(d).val(f)):b(d).val(c.val()))}),b(document).ajaxSend(function(b,c,d){"add-meta"==d.action&&(a=d.element)}),b(document).ajaxComplete(function(d,e,f){"add-meta"==f.action&&c("newmeta"==a?"meta-"+b(e.responseXML.documentElement.outerHTML).find("meta").attr("id"):a)}),WPGlobusDialogApp.init({title:"Edit meta"})}},new a.App,a}(window.WPGlobusAdminApp||{},jQuery)});